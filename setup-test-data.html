<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Data Setup - Tam Veri Demo Web</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }

        .button {
            background: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            min-width: 200px;
        }

        .button:hover {
            background: #45a049;
        }

        .button:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }

        .log-area {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }

        .section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ”§ Tam Veri Demo Web Test Data Setup</h1>

        <div class="info">
            <strong>ğŸ“‹ Bu sayfa ile:</strong><br>
            â€¢ Firestore veritabanÄ±na test kullanÄ±cÄ±sÄ±, iÅŸyeri ve makine verileri ekleyebilirsiniz<br>
            â€¢ Mevcut verilerin Ã¼zerine yazÄ±lacaktÄ±r<br>
            â€¢ Test verisi eklendikten sonra dashboard'a giriÅŸ yapabilirsiniz
        </div>

        <div class="section">
            <h3>ğŸš€ Test Verilerini OluÅŸtur</h3>
            <button class="button" id="createAllBtn" onclick="createAllTestData()">
                TÃ¼m Test Verilerini OluÅŸtur
            </button>
            <button class="button" id="createUserBtn" onclick="createTestUser()">
                Sadece Test KullanÄ±cÄ±sÄ±
            </button>
            <button class="button" id="createMachinesBtn" onclick="createTestMachines()">
                Sadece Test Makineleri
            </button>
        </div>

        <div class="section">
            <h3>ğŸ”„ Kontrol Ä°ÅŸlemleri</h3>
            <button class="button" id="checkDataBtn" onclick="checkExistingData()">
                Mevcut Verileri Kontrol Et
            </button>
            <button class="button" id="clearLogBtn" onclick="clearLog()">
                LoglarÄ± Temizle
            </button>
        </div>

        <div class="section">
            <h3>ğŸ“Š Test Bilgileri</h3>
            <p><strong>Test KullanÄ±cÄ±sÄ±:</strong> admin@test.com</p>
            <p><strong>Ä°ÅŸyeri:</strong> MetalWorks Ltd.</p>
            <p><strong>Makine SayÄ±sÄ±:</strong> 5 adet (farklÄ± durumlar)</p>
            <p><strong>KullanÄ±cÄ± RolÃ¼:</strong> Admin</p>
        </div>

        <div class="log-area" id="logArea">
            === Test Data Setup Logs ===
            Firebase baÄŸlantÄ±sÄ± kontrol ediliyor...
        </div>
    </div>

    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="js/firebase-config.js"></script>

    <!-- Test Data Creation Script -->
    <script src="create-test-data.js"></script>

    <script>
        // Log helper function
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `\n[${timestamp}] ${message}`;
            logArea.scrollTop = logArea.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            document.getElementById('logArea').textContent = '=== Test Data Setup Logs ===\n';
        }

        // Check if Firebase is connected
        function checkFirebaseConnection() {
            if (typeof firebase === 'undefined') {
                log('âŒ Firebase CDN yÃ¼klenemedi!');
                return false;
            }

            if (!window.auth || !window.db) {
                log('âŒ Firebase auth/db global deÄŸiÅŸkenleri bulunamadÄ±!');
                return false;
            }

            log('âœ… Firebase baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±');
            return true;
        }

        // Check existing data in Firestore
        async function checkExistingData() {
            if (!checkFirebaseConnection()) return;

            try {
                log('ğŸ” Mevcut veriler kontrol ediliyor...');

                // Check users
                const usersSnapshot = await db.collection('users').get();
                log(`ğŸ‘¥ Toplam kullanÄ±cÄ± sayÄ±sÄ±: ${usersSnapshot.size}`);

                // Check workplaces
                const workplacesSnapshot = await db.collection('workplaces').get();
                log(`ğŸ¢ Toplam iÅŸyeri sayÄ±sÄ±: ${workplacesSnapshot.size}`);

                // Check machines in workplace_2
                const machinesSnapshot = await db.collection('workplaces').doc('workplace_2').collection('machines').get();
                log(`ğŸ”§ workplace_2'deki makine sayÄ±sÄ±: ${machinesSnapshot.size}`);

                if (machinesSnapshot.size > 0) {
                    log('ğŸ“‹ Mevcut makineler:');
                    machinesSnapshot.forEach(doc => {
                        const machine = doc.data();
                        log(`  - ${machine.name} (${machine.status})`);
                    });
                }

                log('âœ… Veri kontrolÃ¼ tamamlandÄ±');

            } catch (error) {
                log(`âŒ Veri kontrolÃ¼ hatasÄ±: ${error.message}`);
            }
        }

        // Enhanced create functions with logging
        async function createTestUser() {
            if (!checkFirebaseConnection()) return;

            try {
                log('ğŸ‘¤ Test kullanÄ±cÄ±sÄ± oluÅŸturuluyor...');
                const userId = 'JRLeX6bnh5aHnQm0Fp5LzToec0m1';

                await db.collection('users').doc(userId).set({
                    fullName: 'Admin User',
                    email: 'admin@test.com',
                    role: 'admin',
                    workplaceId: 'workplace_2',
                    isApproved: true,
                    createdAt: new Date(),
                    updatedAt: new Date()
                });

                log('âœ… Test kullanÄ±cÄ±sÄ± baÅŸarÄ±yla oluÅŸturuldu');
            } catch (error) {
                log(`âŒ Test kullanÄ±cÄ±sÄ± oluÅŸturma hatasÄ±: ${error.message}`);
            }
        }

        async function createTestMachines() {
            if (!checkFirebaseConnection()) return;

            try {
                log('ğŸ”§ Test makineleri oluÅŸturuluyor...');
                const workplaceId = 'workplace_2';
                const testMachines = [
                    {
                        name: 'CNC Torna Makinesi 1',
                        description: 'YÃ¼ksek hassasiyetli CNC torna makinesi',
                        status: 'active',
                        assignedUserIds: ['JRLeX6bnh5aHnQm0Fp5LzToec0m1'],
                        tips: 'DÃ¼zenli bakÄ±m yapÄ±lmalÄ±',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        name: 'Freze Makinesi A1',
                        description: 'Otomatik freze makinesi',
                        status: 'maintenance',
                        assignedUserIds: ['JRLeX6bnh5aHnQm0Fp5LzToec0m1'],
                        tips: 'SoÄŸutma sÄ±vÄ±sÄ± kontrol edilmeli',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        name: 'Kaynak Makinesi K5',
                        description: 'EndÃ¼striyel kaynak makinesi',
                        status: 'error',
                        assignedUserIds: [],
                        tips: 'Elektrot deÄŸiÅŸimi gerekli',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        name: 'Pres Makinesi P3',
                        description: 'Hidrolik pres makinesi',
                        status: 'active',
                        assignedUserIds: ['JRLeX6bnh5aHnQm0Fp5LzToec0m1'],
                        tips: 'BasÄ±nÃ§ seviyesi gÃ¼nlÃ¼k kontrol edilmeli',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    },
                    {
                        name: 'Testere Makinesi T2',
                        description: 'Metal kesim testere makinesi',
                        status: 'stopped',
                        assignedUserIds: [],
                        tips: 'BÄ±Ã§ak deÄŸiÅŸimi zamanÄ±',
                        createdAt: new Date(),
                        updatedAt: new Date()
                    }
                ];

                // Clear existing machines first
                const existingMachines = await db.collection('workplaces').doc(workplaceId).collection('machines').get();
                const batch = db.batch();
                existingMachines.forEach(doc => {
                    batch.delete(doc.ref);
                });
                await batch.commit();
                log('ğŸ—‘ï¸ Mevcut makineler temizlendi');

                // Add new machines
                for (const machine of testMachines) {
                    await db.collection('workplaces').doc(workplaceId).collection('machines').add(machine);
                    log(`âœ… ${machine.name} eklendi`);
                }

                log('âœ… TÃ¼m test makineleri baÅŸarÄ±yla oluÅŸturuldu');
            } catch (error) {
                log(`âŒ Test makineleri oluÅŸturma hatasÄ±: ${error.message}`);
            }
        }

        async function updateTestWorkplace() {
            if (!checkFirebaseConnection()) return;

            try {
                log('ğŸ¢ Test iÅŸyeri gÃ¼ncelleniyor...');
                await db.collection('workplaces').doc('workplace_2').set({
                    name: 'MetalWorks Ltd.',
                    location: 'Ankara, Turkey',
                    adminId: 'JRLeX6bnh5aHnQm0Fp5LzToec0m1',
                    createdAt: new Date(),
                    updatedAt: new Date()
                });

                log('âœ… Test iÅŸyeri baÅŸarÄ±yla gÃ¼ncellendi');
            } catch (error) {
                log(`âŒ Test iÅŸyeri gÃ¼ncelleme hatasÄ±: ${error.message}`);
            }
        }

        async function createAllTestData() {
            if (!checkFirebaseConnection()) return;

            log('ğŸš€ TÃ¼m test verileri oluÅŸturuluyor...');

            // Disable buttons during creation
            const buttons = document.querySelectorAll('.button');
            buttons.forEach(btn => btn.disabled = true);

            try {
                await createTestUser();
                await updateTestWorkplace();
                await createTestMachines();
                log('ğŸ‰ TÃ¼m test verileri baÅŸarÄ±yla oluÅŸturuldu!');
                log('ğŸ’¡ ArtÄ±k dashboard.html sayfasÄ±na gidip giriÅŸ yapabilirsiniz');
                log('ğŸ“§ Email: admin@test.com');
            } catch (error) {
                log(`âŒ Test verisi oluÅŸturma hatasÄ±: ${error.message}`);
            } finally {
                // Re-enable buttons
                buttons.forEach(btn => btn.disabled = false);
            }
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkFirebaseConnection();
                log('ğŸ”„ Sayfa yÃ¼klendi, hazÄ±r durumda');
            }, 1000);
        });
    </script>
</body>

</html>